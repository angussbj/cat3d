(this.webpackJsonpcat3d=this.webpackJsonpcat3d||[]).push([[0],{81:function(e,t,n){},93:function(e,t,n){},98:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),i=n(32),c=n.n(i),s=(n(81),n(13)),a=n(8);n(57),n(120);var d=n(27),u=n.n(d),l={HIGHLIGHTS:[u()("#11E533")],BLACK:u()("#000000"),DARK:u()("#0d1416"),GREY:u()("#475154"),LIGHT:u()("#f7f9f9"),WHITE:u()("#FFFFFF"),LIGHTING:{WARM:u()("#FFCCCC"),NEUTRAL:u()("#E5CCE5"),COLD:u()("#CCCCFF")}};var h,j,b=n(33),f=n(34);f.a.div(h||(h=Object(b.a)(["\n  display: flex;\n  flex-direction: column;\n"])));f.a.div(j||(j=Object(b.a)(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n"])));var O,w=n(9);f.a.div(O||(O=Object(b.a)(["\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n"]))),n(93);n(19);n(119);var v=n(15),g=n(70),m=n(5),y=Object(r.createContext)({setCurrentlyDragging:function(){},setOnBackgroundClick:function(){},setControlMode:function(){},controlMode:"view",render:function(){}});function C(e){var t=e.children,n=e.environment;return Object(a.jsx)(y.Provider,{value:n,children:t})}function k(){return Object(r.useContext)(y)}var I=function(e){var t=e.position,n=void 0===t?new m.Vector3(0,0,0):t,o=e.onClick,i=e.children,c=Object(r.useRef)(null),d=k().setCurrentlyDragging,u=Object(v.k)(),l=u.camera,h=u.size,j=Object(r.useMemo)((function(){return new m.Raycaster}),[]),b=Object(r.useRef)(new m.Plane(new m.Vector3(0,0,1))),f=Object(r.useRef)(new m.Vector3(0,0,0));Object(r.useEffect)((function(){c.current&&c.current.position.copy(n)}),[]);var O=Object(r.useCallback)((function(e,t){var n=new m.Vector2(e/h.width*2-1,-t/h.height*2+1),r=new m.Vector3;return j.setFromCamera(n,l),j.ray.intersectPlane(b.current,r),r}),[]),y=Object(g.a)((function(e){var t=Object(s.a)(e.xy,2),r=t[0],i=t[1],a=Object(s.a)(e.movement,2),u=a[0],h=a[1],j=e.first,w=e.last,v=e.event;if(v.stopPropagation(),j){var g,y;d(!0);var C=new m.Vector3;l.getWorldDirection(C),b.current.setFromNormalAndCoplanarPoint(C,(null===(g=c.current)||void 0===g?void 0:g.position)||new m.Vector3(0,0,0)),f.current=(null===(y=c.current)||void 0===y?void 0:y.position.clone().sub(O(r,i)))||new m.Vector3(0,0,0)}c.current&&c.current.position.copy(O(r,i).add(f.current)),w&&(d(!1),c.current&&n.copy(c.current.position),0===u&&0===h&&(null===o||void 0===o||o(v)))}));return Object(a.jsx)("group",Object(w.a)(Object(w.a)({},y()),{},{ref:c,children:i}))},p=n(14),x=n(1),S=n(4);function A(e){return Object.keys(e)}var L=n(71);function G(e){return e.startsWith("n")}function H(e){return e.startsWith("1a")}var E=function(){function e(t){Object(x.a)(this,e),this.render=t,this.nodes={},this.arrows={},this.twoArrows={},this.threeArrows={},this.nodeIdCounter=0,this.arrowIdCounter=0,this.twoArrowIdCounter=0,this.threeArrowIdCounter=0,this.selected={}}return Object(S.a)(e,[{key:"addNode",value:function(e){var t="n".concat(this.nodeIdCounter);this.nodeIdCounter+=1,this.nodes[t]={position:e,id:t},this.selected={},this.render(),Object(L.a)(this)}},{key:"addArrow",value:function(e,t){var n="1a".concat(this.arrowIdCounter);this.arrowIdCounter+=1,this.arrows[n]={domainId:e,codomainId:t,id:n,guidePoint:(new m.Vector3).copy(this.nodes[e].position).add(this.nodes[t].position).multiplyScalar(.5)}}},{key:"getNodes",value:function(){return Object.values(this.nodes)}},{key:"getArrows",value:function(){return Object.values(this.arrows)}},{key:"getArrowPoints",value:function(e){var t=this.arrows[e],n=t.domainId,r=t.guidePoint,o=t.codomainId;return[this.nodes[n].position,r,this.nodes[o].position]}},{key:"getSelectedNodeIds",value:function(){var e=this;return A(this.selected).filter(G).filter((function(t){return e.selected[t]}))}},{key:"getSelectedArrowIds",value:function(){var e=this;return A(this.selected).filter(H).filter((function(t){return e.selected[t]}))}},{key:"onClick",value:function(e,t){G(e)?this.onNodeClick(e,t):H(e)&&this.onArrowClick(e,t),console.log(this.selected,this.nodes),this.render()}},{key:"onNodeClick",value:function(e,t){var n=this;this.isSelected(e)?t.shiftKey?this.selected[e]=!1:this.selected={}:t.shiftKey?this.selected[e]=!0:t.ctrlKey||t.metaKey?(this.getSelectedNodeIds().forEach((function(t){n.addArrow(t,e)})),this.selected={}):this.selected=Object(p.a)({},e,!0)}},{key:"onArrowClick",value:function(e,t){this.isSelected(e)?t.shiftKey?this.selected[e]=!1:this.selected={}:!t.shiftKey||t.ctrlKey||t.metaKey?t.ctrlKey||t.metaKey?this.selected={}:this.selected=Object(p.a)({},e,!0):this.selected[e]=!0}},{key:"isSelected",value:function(e){return!!this.selected[e]}},{key:"deleteNode",value:function(e){var t=this;delete this.nodes[e],A(this.arrows).forEach((function(n){var r=t.arrows[n];r.codomainId!==e&&r.domainId!==e||delete t.arrows[n]}))}},{key:"deleteArrow",value:function(e){var t=this;delete this.arrows[e],A(this.twoArrows).forEach((function(n){var r=t.twoArrows[n];(r.codomainIds.includes(e)||r.domainIds.includes(e))&&delete t.twoArrows[n]}))}},{key:"deleteTwoArrow",value:function(e){var t=this;delete this.twoArrows[e],A(this.threeArrows).forEach((function(n){var r=t.threeArrows[n];(r.codomainIds.includes(e)||r.domainIds.includes(e))&&delete t.threeArrows[n]}))}},{key:"deleteThreeArrow",value:function(e){delete this.threeArrows[e]}},{key:"onKeyDown",value:function(e){var t=this;"Backspace"===e.key&&(A(this.selected).forEach((function(e){G(e)&&t.deleteNode(e),H(e)&&t.deleteArrow(e),function(e){return e.startsWith("2a")}(e)&&t.deleteTwoArrow(e),function(e){return e.startsWith("3a")}(e)&&t.deleteThreeArrow(e)})),this.selected={},this.render())}}]),e}();function K(e){var t=e.color;return Object(a.jsx)("meshBasicMaterial",{attach:"material",color:t.toString(),side:m.BackSide})}function M(e){var t=e.color;return Object(a.jsx)("meshStandardMaterial",{attach:"material",color:t.toString(),emissiveIntensity:0,roughness:.5})}function N(e){var t=e.color;return Object(a.jsx)("meshStandardMaterial",{attach:"material",color:t.toString(),opacity:.3,transparent:!0})}var T=n(31),F=n(20),P=n(73);function R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.02,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:48;return new P.a.TubeGeometry(3===e.length?Object(T.a)(m.QuadraticBezierCurve3,Object(F.a)(e)):Object(T.a)(m.CubicBezierCurve3,Object(F.a)(e)),n,t,12)}function V(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.05,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=[],r=0;r<=t;r++)n.push(new m.Vector2(e*Math.sin(r*Math.PI/t),-e*Math.cos(r*Math.PI/t)));return new m.LatheGeometry(n,2*t)}function B(){var e=k(),t=e.setOnBackgroundClick,n=e.render,o=Object(r.useRef)(new E(n)).current,i=Object(v.k)(),c=i.camera,d=i.size;Object(r.useEffect)((function(){return document.addEventListener("keydown",o.onKeyDown.bind(o)),function(){document.removeEventListener("keydown",o.onKeyDown.bind(o))}}),[]);var u=Object(r.useState)(.1),h=Object(s.a)(u,1)[0],j=Object(r.useState)(.07),b=Object(s.a)(j,1)[0],f=Object(r.useState)(.005),O=Object(s.a)(f,1)[0],w=Object(r.useState)(.02),g=Object(s.a)(w,1)[0],y=Object(r.useMemo)((function(){return new m.Raycaster}),[]),C=Object(r.useMemo)((function(){return new m.Plane(new m.Vector3(0,1,0))}),[]);return Object(r.useEffect)((function(){return t((function(){return function(e){if(!(e.ctrlKey||e.altKey||e.metaKey||e.shiftKey||e.button>1)){var t=new m.Vector2(e.x/d.width*2-1,-e.y/d.height*2+1),r=new m.Vector3;y.setFromCamera(t,c),y.ray.intersectPlane(C,r),o.addNode(r),n()}}}))}),[t]),Object(a.jsxs)(a.Fragment,{children:[o.getNodes().map((function(e){var t=e.position,n=e.id;return Object(a.jsxs)(I,{position:t,onClick:function(e){return o.onClick(n,e)},children:[Object(a.jsx)("mesh",{geometry:V(h),castShadow:!0,receiveShadow:!0,children:Object(a.jsx)(M,{color:l.GREY})}),o.isSelected(n)&&Object(a.jsx)("mesh",{geometry:V(h+O),children:Object(a.jsx)(K,{color:l.HIGHLIGHTS[0]})})]},n)})),o.getArrows().map((function(e,t){var n=e.id,r=e.guidePoint;return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("mesh",{geometry:R(o.getArrowPoints(n),g),onClick:function(e){return o.onClick(n,e)},castShadow:!0,receiveShadow:!0,children:Object(a.jsx)(M,{color:l.GREY})},n),o.isSelected(n)&&Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("mesh",{geometry:R(o.getArrowPoints(n),g+O),children:Object(a.jsx)(K,{color:l.HIGHLIGHTS[0]})},n+"highlight"),Object(a.jsx)(I,{position:r,children:Object(a.jsx)("mesh",{geometry:V(b),children:Object(a.jsx)(N,{color:l.HIGHLIGHTS[0]})})},n+"guidePoint")]})]})}))]})}var D=n(38),W=function(){return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("ambientLight",{intensity:.45}),Object(a.jsx)("directionalLight",{position:[0,0,20],color:l.LIGHTING.WARM.toString(),castShadow:!0}),Object(a.jsx)("directionalLight",{position:[17,0,-10],color:l.LIGHTING.COLD.toString(),castShadow:!0}),Object(a.jsx)("directionalLight",{position:[-17,0,-10],color:l.LIGHTING.NEUTRAL.toString(),castShadow:!0}),Object(a.jsx)("directionalLight",{position:[0,20,0],color:l.LIGHTING.WARM.toString(),castShadow:!0}),Object(a.jsx)("directionalLight",{position:[0,-20,0],color:l.LIGHTING.COLD.toString(),castShadow:!0})]})},z=n(121);function Y(e){var t=e.children,n=Object(r.useState)(!1),o=Object(s.a)(n,2),i=o[0],c=o[1],d=Object(r.useState)("view"),u=Object(s.a)(d,2),h=u[0],j=u[1],b=Object(r.useState)((function(){})),f=Object(s.a)(b,2),O=f[0],w=f[1],v=Object(r.useState)(!1),g=Object(s.a)(v,2),m=(g[0],g[1]),y=Object(r.useCallback)((function(){return m((function(e){return!e}))}),[]);return Object(a.jsx)("div",{style:{position:"absolute",left:0,right:0,top:0,bottom:0},children:Object(a.jsx)(C,{environment:{setCurrentlyDragging:c,setOnBackgroundClick:w,setControlMode:j,controlMode:h,render:y},children:Object(a.jsxs)(D.a,{style:{background:l.BLACK.toString()},camera:{position:[4,4,10]},onPointerMissed:O,shadows:!0,children:[Object(a.jsx)("gridHelper",{args:[20,20]}),Object(a.jsx)(W,{}),t,!i&&"view"==h&&Object(a.jsx)(z.a,{autoRotate:!1})]})})})}var J=function(){return Object(a.jsx)(Y,{children:Object(a.jsx)(B,{})})};c.a.render(Object(a.jsx)(o.a.StrictMode,{children:Object(a.jsx)(J,{})}),document.getElementById("root"))}},[[98,1,2]]]);
//# sourceMappingURL=main.7e173586.chunk.js.map
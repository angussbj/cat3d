(this.webpackJsonpcat3d=this.webpackJsonpcat3d||[]).push([[0],{81:function(e,t,n){},93:function(e,t,n){},98:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),i=n(32),s=n.n(i),c=(n(81),n(13)),a=n(8);n(57),n(120);var d=n(27),u=n.n(d),l={HIGHLIGHTS:[u()("#11E533")],BLACK:u()("#000000"),DARK:u()("#0d1416"),GREY:u()("#475154"),LIGHT:u()("#f7f9f9"),WHITE:u()("#FFFFFF"),LIGHTING:{WARM:u()("#FFCCCC"),NEUTRAL:u()("#E5CCE5"),COLD:u()("#CCCCFF")}};var h,j,f=n(33),w=n(34);w.a.div(h||(h=Object(f.a)(["\n  display: flex;\n  flex-direction: column;\n"])));w.a.div(j||(j=Object(f.a)(["\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n"])));var b,v=n(9);w.a.div(b||(b=Object(f.a)(["\n  -webkit-touch-callout: none;\n  -webkit-user-select: none;\n  -khtml-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n"]))),n(93);n(19);n(119);var O=n(15),m=n(70),g=n(5),y=Object(r.createContext)({setCurrentlyDragging:function(){},setOnBackgroundClick:function(){},setControlMode:function(){},controlMode:"view",render:function(){}});function p(e){var t=e.children,n=e.environment;return Object(a.jsx)(y.Provider,{value:n,children:t})}function k(){return Object(r.useContext)(y)}var x=function(e){var t=e.position,n=void 0===t?new g.Vector3(0,0,0):t,o=e.onClick,i=e.children,s=Object(r.useRef)(null),d=k().setCurrentlyDragging,u=Object(O.k)(),l=u.camera,h=u.size,j=Object(r.useMemo)((function(){return new g.Raycaster}),[]),f=Object(r.useRef)(new g.Plane(new g.Vector3(0,0,1))),w=Object(r.useRef)(new g.Vector3(0,0,0));Object(r.useEffect)((function(){s.current&&s.current.position.copy(n)}),[]);var b=Object(r.useCallback)((function(e,t){var n=new g.Vector2(e/h.width*2-1,-t/h.height*2+1),r=new g.Vector3;return j.setFromCamera(n,l),j.ray.intersectPlane(f.current,r),r}),[]),y=Object(m.a)((function(e){var t=Object(c.a)(e.xy,2),r=t[0],i=t[1],a=Object(c.a)(e.movement,2),u=a[0],h=a[1],j=e.first,v=e.last,O=e.event;if(O.stopPropagation(),j){var m,y;d(!0);var p=new g.Vector3;l.getWorldDirection(p),f.current.setFromNormalAndCoplanarPoint(p,(null===(m=s.current)||void 0===m?void 0:m.position)||new g.Vector3(0,0,0)),w.current=(null===(y=s.current)||void 0===y?void 0:y.position.clone().sub(b(r,i)))||new g.Vector3(0,0,0)}s.current&&s.current.position.copy(b(r,i).add(w.current)),v&&(d(!1),s.current&&n.copy(s.current.position),0===u&&0===h&&(null===o||void 0===o||o(O)))}));return Object(a.jsx)("group",Object(v.a)(Object(v.a)({},y()),{},{ref:s,children:i}))},C=n(14),I=n(1),S=n(4);function A(e){return Object.keys(e)}var F=n(71);function L(e){return e.startsWith("n")}function G(e){return e.startsWith("1a")}var N=function(){function e(t){Object(I.a)(this,e),this.render=t,this.nodes={},this.arrows={},this.twoArrows={},this.threeArrows={},this.nodeIdCounter=0,this.arrowIdCounter=0,this.twoArrowIdCounter=0,this.threeArrowIdCounter=0,this.selected={};var n=new URLSearchParams(window.location.search),r=n.get("n");r&&this.setNodesFromSerialisedNodes(r);var o=n.get("a");o&&this.setArrowsFromSerialisedArrows(o)}return Object(S.a)(e,[{key:"update",value:function(){var e=new URL(window.location.toString());e.searchParams.set("n",this.serialisedNodes()),e.searchParams.set("a",this.serialisedArrows()),window.history.pushState({},"",e),this.render()}},{key:"serialisedNodes",value:function(){return Object.values(this.nodes).map((function(e){return[e.id,e.position.x.toFixed(3),e.position.y.toFixed(3),e.position.z.toFixed(3)].join("*")})).join("_")}},{key:"setNodesFromSerialisedNodes",value:function(e){var t=this;this.nodes={},e.split("_").forEach((function(e){var n=e.split("*");t.nodes[n[0]]={id:n[0],position:new g.Vector3(parseFloat(n[1]),parseFloat(n[2]),parseFloat(n[3]))}}))}},{key:"serialisedArrows",value:function(){return Object.values(this.arrows).map((function(e){return[e.id,e.domainId,e.codomainId,e.guidePoint.x.toFixed(3),e.guidePoint.y.toFixed(3),e.guidePoint.z.toFixed(3)].join("*")})).join("_")}},{key:"setArrowsFromSerialisedArrows",value:function(e){var t=this;this.arrows={},e.split("_").forEach((function(e){var n=e.split("*");t.arrows[n[0]]={id:n[0],domainId:n[1],codomainId:n[2],guidePoint:new g.Vector3(parseFloat(n[3]),parseFloat(n[4]),parseFloat(n[5]))}}))}},{key:"addNode",value:function(e){var t="n".concat(this.nodeIdCounter);this.nodeIdCounter+=1,this.nodes[t]={position:e,id:t},this.selected={},this.update(),Object(F.a)(this)}},{key:"addArrow",value:function(e,t){var n="1a".concat(this.arrowIdCounter);this.arrowIdCounter+=1,this.arrows[n]={domainId:e,codomainId:t,id:n,guidePoint:(new g.Vector3).copy(this.nodes[e].position).add(this.nodes[t].position).multiplyScalar(.5)}}},{key:"getNodes",value:function(){return Object.values(this.nodes)}},{key:"getArrows",value:function(){return Object.values(this.arrows)}},{key:"getArrowPoints",value:function(e){var t=this.arrows[e],n=t.domainId,r=t.guidePoint,o=t.codomainId;return[this.nodes[n].position,r,this.nodes[o].position]}},{key:"getSelectedNodeIds",value:function(){var e=this;return A(this.selected).filter(L).filter((function(t){return e.selected[t]}))}},{key:"getSelectedArrowIds",value:function(){var e=this;return A(this.selected).filter(G).filter((function(t){return e.selected[t]}))}},{key:"onClick",value:function(e,t){L(e)?this.onNodeClick(e,t):G(e)&&this.onArrowClick(e,t),this.update()}},{key:"onNodeClick",value:function(e,t){var n=this;this.isSelected(e)?t.shiftKey?this.selected[e]=!1:this.selected={}:t.shiftKey?this.selected[e]=!0:t.ctrlKey||t.metaKey?(this.getSelectedNodeIds().forEach((function(t){n.addArrow(t,e)})),this.selected={}):this.selected=Object(C.a)({},e,!0)}},{key:"onArrowClick",value:function(e,t){this.isSelected(e)?t.shiftKey?this.selected[e]=!1:this.selected={}:!t.shiftKey||t.ctrlKey||t.metaKey?t.ctrlKey||t.metaKey?this.selected={}:this.selected=Object(C.a)({},e,!0):this.selected[e]=!0}},{key:"isSelected",value:function(e){return!!this.selected[e]}},{key:"deleteNode",value:function(e){var t=this;delete this.nodes[e],A(this.arrows).forEach((function(n){var r=t.arrows[n];r.codomainId!==e&&r.domainId!==e||delete t.arrows[n]}))}},{key:"deleteArrow",value:function(e){var t=this;delete this.arrows[e],A(this.twoArrows).forEach((function(n){var r=t.twoArrows[n];(r.codomainIds.includes(e)||r.domainIds.includes(e))&&delete t.twoArrows[n]}))}},{key:"deleteTwoArrow",value:function(e){var t=this;delete this.twoArrows[e],A(this.threeArrows).forEach((function(n){var r=t.threeArrows[n];(r.codomainIds.includes(e)||r.domainIds.includes(e))&&delete t.threeArrows[n]}))}},{key:"deleteThreeArrow",value:function(e){delete this.threeArrows[e]}},{key:"onKeyDown",value:function(e){var t=this;"Backspace"===e.key&&(A(this.selected).forEach((function(e){L(e)&&t.deleteNode(e),G(e)&&t.deleteArrow(e),function(e){return e.startsWith("2a")}(e)&&t.deleteTwoArrow(e),function(e){return e.startsWith("3a")}(e)&&t.deleteThreeArrow(e)})),this.selected={},this.update())}}]),e}();function P(e){var t=e.color;return Object(a.jsx)("meshBasicMaterial",{attach:"material",color:t.toString(),side:g.BackSide})}function E(e){var t=e.color;return Object(a.jsx)("meshStandardMaterial",{attach:"material",color:t.toString(),emissiveIntensity:0,roughness:.5})}function H(e){var t=e.color;return Object(a.jsx)("meshStandardMaterial",{attach:"material",color:t.toString(),opacity:.3,transparent:!0})}var K=n(31),M=n(20),T=n(73);function R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.02,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:48;return new T.a.TubeGeometry(3===e.length?Object(K.a)(g.QuadraticBezierCurve3,Object(M.a)(e)):Object(K.a)(g.CubicBezierCurve3,Object(M.a)(e)),n,t,12)}function V(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.05,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=[],r=0;r<=t;r++)n.push(new g.Vector2(e*Math.sin(r*Math.PI/t),-e*Math.cos(r*Math.PI/t)));return new g.LatheGeometry(n,2*t)}function B(){var e=k(),t=e.setOnBackgroundClick,n=e.render,o=Object(r.useRef)(new N(n)).current,i=Object(O.k)(),s=i.camera,d=i.size;Object(r.useEffect)((function(){return document.addEventListener("keydown",o.onKeyDown.bind(o)),function(){document.removeEventListener("keydown",o.onKeyDown.bind(o))}}),[]);var u=Object(r.useState)(.1),h=Object(c.a)(u,1)[0],j=Object(r.useState)(.07),f=Object(c.a)(j,1)[0],w=Object(r.useState)(.005),b=Object(c.a)(w,1)[0],v=Object(r.useState)(.02),m=Object(c.a)(v,1)[0],y=Object(r.useMemo)((function(){return new g.Raycaster}),[]),p=Object(r.useMemo)((function(){return new g.Plane(new g.Vector3(0,1,0))}),[]);return Object(r.useEffect)((function(){return t((function(){return function(e){if(!(e.ctrlKey||e.altKey||e.metaKey||e.shiftKey||e.button>1)){var t=new g.Vector2(e.x/d.width*2-1,-e.y/d.height*2+1),r=new g.Vector3;y.setFromCamera(t,s),y.ray.intersectPlane(p,r),o.addNode(r),n()}}}))}),[t]),Object(a.jsxs)(a.Fragment,{children:[o.getNodes().map((function(e){var t=e.position,n=e.id;return Object(a.jsxs)(x,{position:t,onClick:function(e){return o.onClick(n,e)},children:[Object(a.jsx)("mesh",{geometry:V(h),castShadow:!0,receiveShadow:!0,children:Object(a.jsx)(E,{color:l.GREY})}),o.isSelected(n)&&Object(a.jsx)("mesh",{geometry:V(h+b),children:Object(a.jsx)(P,{color:l.HIGHLIGHTS[0]})})]},n)})),o.getArrows().map((function(e,t){var n=e.id,r=e.guidePoint;return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("mesh",{geometry:R(o.getArrowPoints(n),m),onClick:function(e){return o.onClick(n,e)},castShadow:!0,receiveShadow:!0,children:Object(a.jsx)(E,{color:l.GREY})},n),o.isSelected(n)&&Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("mesh",{geometry:R(o.getArrowPoints(n),m+b),children:Object(a.jsx)(P,{color:l.HIGHLIGHTS[0]})},n+"highlight"),Object(a.jsx)(x,{position:r,children:Object(a.jsx)("mesh",{geometry:V(f),children:Object(a.jsx)(H,{color:l.HIGHLIGHTS[0]})})},n+"guidePoint")]})]})}))]})}var D=n(38),W=function(){return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)("ambientLight",{intensity:.45}),Object(a.jsx)("directionalLight",{position:[0,0,20],color:l.LIGHTING.WARM.toString(),castShadow:!0}),Object(a.jsx)("directionalLight",{position:[17,0,-10],color:l.LIGHTING.COLD.toString(),castShadow:!0}),Object(a.jsx)("directionalLight",{position:[-17,0,-10],color:l.LIGHTING.NEUTRAL.toString(),castShadow:!0}),Object(a.jsx)("directionalLight",{position:[0,20,0],color:l.LIGHTING.WARM.toString(),castShadow:!0}),Object(a.jsx)("directionalLight",{position:[0,-20,0],color:l.LIGHTING.COLD.toString(),castShadow:!0})]})},z=n(121);function U(e){var t=e.children,n=Object(r.useState)(!1),o=Object(c.a)(n,2),i=o[0],s=o[1],d=Object(r.useState)("view"),u=Object(c.a)(d,2),h=u[0],j=u[1],f=Object(r.useState)((function(){})),w=Object(c.a)(f,2),b=w[0],v=w[1],O=Object(r.useState)(!1),m=Object(c.a)(O,2),g=(m[0],m[1]),y=Object(r.useCallback)((function(){return g((function(e){return!e}))}),[]);return Object(a.jsx)("div",{style:{position:"absolute",left:0,right:0,top:0,bottom:0},children:Object(a.jsx)(p,{environment:{setCurrentlyDragging:s,setOnBackgroundClick:v,setControlMode:j,controlMode:h,render:y},children:Object(a.jsxs)(D.a,{style:{background:l.BLACK.toString()},camera:{position:[4,4,10]},onPointerMissed:b,shadows:!0,children:[Object(a.jsx)("gridHelper",{args:[20,20]}),Object(a.jsx)(W,{}),t,!i&&"view"==h&&Object(a.jsx)(z.a,{autoRotate:!1})]})})})}var _=function(){return Object(a.jsx)(U,{children:Object(a.jsx)(B,{})})};s.a.render(Object(a.jsx)(o.a.StrictMode,{children:Object(a.jsx)(_,{})}),document.getElementById("root"))}},[[98,1,2]]]);
//# sourceMappingURL=main.11c33a97.chunk.js.map